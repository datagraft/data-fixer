<template #rolesTip>
  <div class="slds-text-title--caps">The roles of this column are detected based on the
    relationships.
  </div>
</template>

<div id="annotation-component" class="slds-panel slds-grid slds-grid_vertical slds-nowrap">
  <div class="slds-panel__section">
    <h3 class="slds-text-heading_small slds-m-bottom_medium" style="margin-top: 0">Column Information</h3>
    <ul>
      <li class="slds-form-element slds-hint-parent slds-border_bottom"><span
        class="slds-form-element__label">Column ID</span>
        <div class="slds-form-element__control">
          <span class="slds-form-element__static">{{annotationService.colNames[colId]}}</span>
        </div>
      </li>

      <li class="slds-form-element slds-hint-parent slds-border_bottom">
        <ngl-form-element [error] = "hasColumnTypeError ? columnTypeError : null">
        <span class="slds-form-element__label">Column Type</span>
        <div class="slds-form-element__control">
          <input nglFormControl ngui-auto-complete [(ngModel)]="annotation.columnType"
                 [source]="typeSuggestions"
                 type="text" attr.data-value="{{ colId }}.ColumnType"
                 placeholder="Insert column type"
                 pattern = {{urlREGEX}} #columnTypeUrl = "ngModel"
                 min-chars="2" >
          <div *ngIf="columnTypeUrl.errors && (columnTypeUrl.dirty || columnTypeUrl.touched)" class="alert alert-danger">
            <div [hidden]="!columnTypeUrl.errors.pattern">
              Must be a valid URL!
            </div>
          </div>
        </div>
        </ngl-form-element>
      </li>
      <li class="slds-form-element slds-hint-parent slds-border_bottom">
        <span class="slds-form-element__label">Column values type</span>
        <div class="slds-form-element__control">
          <fieldset ngl-form-group-alt [required]="required"
                    [error] = "hasSubjectError ? subjectError : (hasUrlLiteralError ? urlLiteralError : null)"
                    class="slds-form-element__static">
            <template nglFormLabel></template>
            <ngl-form-group-element *ngFor="let columnDataType of ['URL', 'Literal']">
              <template nglFormLabel>{{columnDataType}}</template>
              <input nglFormControl type="radio"
                     name="{{ colId }}.columnDataType" value="URL"
                     (click)="dataTypeSelect(columnDataType)">
            </ngl-form-group-element>
          </fieldset>
        </div>
      </li>
      <li class="slds-form-element slds-hint-parent slds-border_bottom">
        <span class="slds-form-element__label">Column roles
          <a [nglPopover]="rolesTip" [nglPopoverPlacement]="placement" [nglOpen]="open"
             (mouseenter)="open = true" (mouseleave)="open = false">
             <ngl-icon icon="question" size="x-small" type="default"></ngl-icon>
          </a></span>
        <div class="slds-form-element__control">
          <ngl-badge [type]="subjectMarker"
                     class="slds-form-element__static slds-m-horizontal--large">SUB
          </ngl-badge>
          <ngl-badge [type]="objectMarker"
                     class="slds-form-element__static slds-m-horizontal--large">OBJ
          </ngl-badge>
        </div>
      </li>
    </ul>
  </div>
  <div class="slds-panel__section">
    <h3 class="slds-text-heading_small slds-m-bottom_medium" style="margin-top: 0">Relationships</h3>
    <ngl-form-element [error] = "hasSourceError ? sourceError :
                                 (hasSourcePropertyError ? sourcePropertyError : null)"
                      class="slds-m-top--small">
      <ul>
        <li class="slds-form-element slds-hint-parent slds-border_bottom">
          <input nglFormControl auto-complete [(ngModel)]="annotation.source"
                 [source]="listOfSubjects"
                 (change)="getSubjects()"
                 type="text" attr.data-value="{{ colId }}.Source"
                 placeholder="Choose a source column"
                 value="{{ annotation.source }}"
                 [required]="required"
                 (change)="subjectValidate(annotation.source)" >

          <input nglFormControl ngui-auto-complete [(ngModel)]="annotation.property"
                 [source]="propertySuggestions"
                 pattern = {{urlREGEX}} #propertyUrl = "ngModel"
                 type="text" attr.data-value="{{ colId }}.Property"
                 placeholder="Insert relationship property"
                 min-chars="2">
          <div *ngIf="propertyUrl.errors && (propertyUrl.dirty || propertyUrl.touched)" class="alert alert-danger">
            <div [hidden]="!propertyUrl.errors.pattern">
              Must be a valid URL!
            </div>
          </div>
        </li>
      </ul>
    </ngl-form-element>
  </div>
</div>
<button type="button" nglButton="neutral" (click)="saveChangesSmall(colId)">Annotate</button>
<button type="button" nglButton="neutral" [routerLink]="['/detail']" (click)="goToDetailMode()">Detail page</button>
